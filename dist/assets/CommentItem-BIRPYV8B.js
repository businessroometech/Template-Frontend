import{r as p,bp as h,cL as l,u as A,j as a,aO as C,L,cm as q,an as J}from"./index-Cw_JW-sQ.js";function w(){return w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},w.apply(this,arguments)}function V(e,t){if(e==null)return{};var n=G(e,t),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)r=o[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function G(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,o;for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}var k=p.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,s=e.size,o=s===void 0?24:s,d=V(e,["color","size"]);return h.createElement("svg",w({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("polyline",{points:"6 9 12 15 18 9"}))});k.propTypes={color:l.string,size:l.oneOfType([l.string,l.number])};k.displayName="ChevronDown";function b(){return b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}function K(e,t){if(e==null)return{};var n=Q(e,t),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)r=o[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Q(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,o;for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}var N=p.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,s=e.size,o=s===void 0?24:s,d=K(e,["color","size"]);return h.createElement("svg",b({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("polyline",{points:"18 15 12 9 6 15"}))});N.propTypes={color:l.string,size:l.oneOfType([l.string,l.number])};N.displayName="ChevronUp";function j(){return j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},j.apply(this,arguments)}function X(e,t){if(e==null)return{};var n=Y(e,t),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)r=o[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Y(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,o;for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}var z=p.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,s=e.size,o=s===void 0?24:s,d=X(e,["color","size"]);return h.createElement("svg",j({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}))});z.propTypes={color:l.string,size:l.oneOfType([l.string,l.number])};z.displayName="MessageSquare";function O(){return O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},O.apply(this,arguments)}function Z(e,t){if(e==null)return{};var n=ee(e,t),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)r=o[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ee(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,o;for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}var P=p.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,s=e.size,o=s===void 0?24:s,d=Z(e,["color","size"]);return h.createElement("svg",O({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"}))});P.propTypes={color:l.string,size:l.oneOfType([l.string,l.number])};P.displayName="ThumbsUp";const te=({post:e,comment:t,level:n,setRefresh:r,refresh:s,parentId:o=null,commentCount:d,setCommentCount:S})=>{const[E,I]=p.useState(!1),[W,R]=p.useState(!1),[y,_]=p.useState(""),[$,B]=p.useState(t.likeStatus||!1),{user:m}=A(),[u,F]=p.useState([]);p.useState(0),console.log("---comment---",t);function U(i,c){return`@${c} ${i}`}const D=async i=>{i.preventDefault(),console.log(e);const c=m==null?void 0:m.id,f=e.Id,T=n<1?t.id:o,x=n<1?y:U(y,t.commenterName);try{const g=await fetch("https://app-backend-8r74.onrender.com/api/v1/post/create-nested-comment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:c,postId:f,commentId:T,text:x})}),v=await g.json();g.ok?(console.log("Comment created successfully:",v.data.comment),S(()=>d+1),r(()=>s+1)):(console.error("Error creating comment:",v.message),alert(`Error: ${v.message}`))}catch(g){console.error("Unexpected error:",g),alert("An unexpected error occurred. Please try again later.")}},H=async()=>{try{const i=await fetch("https://app-backend-8r74.onrender.com/api/v1/post/create-like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m==null?void 0:m.id,postId:e.Id,commentId:t.id,status:!$})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);B(c=>!c)}catch(i){console.error("Error toggling like:",i)}},M=async i=>{var c;if(!i)throw new Error("commentId is required.");try{const f=await fetch("https://app-backend-8r74.onrender.com/api/v1/post/get-nested-comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commentId:i})});if(!f.ok){const x=await f.json();throw new Error(x.message||"Failed to fetch replies.")}return((c=(await f.json()).data)==null?void 0:c.nestedComments)||[]}catch(f){throw console.error("Error fetching replies:",f),f}};return p.useEffect(()=>{const i=async()=>{try{const c=await M(t.id);console.log("this is the res",c),F(c)}catch(c){console.error("Error in useEffect:",c)}};n<1&&i()},[t.id]),console.log("this is replies",u),a.jsxs("li",{className:"comment-item",children:[a.jsxs("div",{className:"d-flex align-items-start mb-3",children:[a.jsx("img",{src:t.avatar||C,alt:`${t.commenterName||t.createdBy}-avatar`,className:"rounded-circle me-3",style:{width:"35px",height:"35px",objectFit:"cover"}}),a.jsxs("div",{className:"bg-light rounded p-3 flex-grow-1",style:{wordWrap:"break-word",overflowWrap:"break-word",wordBreak:"break-word",maxWidth:"100%"},children:[a.jsxs("div",{className:"d-flex justify-content-between",children:[a.jsx(L,{to:`/profile/feed/${t==null?void 0:t.id}`,children:a.jsx("h6",{className:"mb-1",children:t.commenterName||t.createdBy})}),a.jsx("small",{className:"ms-2",children:t.timestamp})]}),a.jsx("p",{className:"small mb-2",style:{whiteSpace:"pre-wrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.text}),a.jsxs("div",{className:"d-flex align-items-center gap-3 small",children:[a.jsxs("span",{role:"button",className:"text-primary d-flex align-items-center",onClick:()=>{console.log("clicked"),H()},children:[$?a.jsx(q,{size:16,className:"me-1"}):a.jsx(P,{size:16,className:"me-1"})," Like"]}),a.jsxs("span",{role:"button",className:"text-primary d-flex align-items-center",onClick:()=>R(i=>!i),children:[a.jsx(z,{size:16,className:"me-1"})," Reply"]}),u&&u.length>0&&n<1&&a.jsx("span",{role:"button",className:"text-secondary d-flex align-items-center",onClick:()=>I(i=>!i),children:E?a.jsxs(a.Fragment,{children:[a.jsx(N,{size:16,className:"me-1"})," Hide Replies"]}):a.jsxs(a.Fragment,{children:[a.jsx(k,{size:16,className:"me-1"})," View Replies (",u.length,")"]})})]})]})]}),W&&a.jsxs("div",{className:"d-flex mb-4 px-3",children:[a.jsx("div",{className:"avatar avatar-xs me-3",children:a.jsx(L,{to:`/profile/feed/${t.commenterId}`,children:a.jsx("span",{role:"button",children:a.jsx("img",{className:"avatar-img rounded-circle",style:{width:"35px",height:"35px",objectFit:"cover"},src:t.avatar||C,alt:"avatar"})})})}),a.jsxs("form",{className:"nav nav-item w-100 d-flex align-items-center",onSubmit:D,style:{gap:"10px"},children:[a.jsx("textarea",{"data-autoresize":!0,className:"form-control bg-light",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",resize:"none",height:"38px",flex:1},rows:1,placeholder:"Add a reply...",value:y,onChange:i=>_(i.target.value)}),a.jsx("button",{className:"btn border-0 d-flex align-items-center justify-content-center",type:"submit",style:{width:"45px",height:"40px",backgroundColor:"#007bff",borderRadius:"20%",cursor:"pointer"},children:a.jsx(J,{style:{color:"#fff",fontSize:"20px"}})})]})]}),E&&u&&u.length>0&&a.jsx("ul",{className:"list-unstyled ms-5",children:u.map((i,c)=>a.jsx(te,{comment:i,level:n+1,post:e,setRefresh:r,refresh:s,parentId:t.id,commentCount:d,setCommentCount:S},c))})]})};export{te as C};
