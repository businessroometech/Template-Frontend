import{u as w,r as i,c4 as q,j as s,aH as F,c as k,d as U,e as E,f as I,Q as z,B as m,d1 as N,d2 as T,d3 as P,d4 as O,L as A,d5 as $,d6 as d}from"./index-Cw_JW-sQ.js";const R=()=>{const{user:a}=w(),[c,v]=i.useState([]),[h,n]=i.useState(!1),[u,p]=i.useState(!1),[f,x]=i.useState({}),[j,y]=i.useState({}),{id:o}=q();i.useEffect(()=>{c.length||g()},[c]);const g=async()=>{n(!0);try{const e=await fetch("https://app-backend-8r74.onrender.com/api/v1/connection/get-connection-list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a==null?void 0:a.id,profileId:o})});if(!e.ok)throw new Error("Failed to fetch connection list.");const t=await e.json();v(t.connections)}catch(e){console.error("Error while fetching connection list:",e)}finally{n(!1)}},C=async e=>{x(r=>({...r,[e]:!0}));const t="https://app-backend-8r74.onrender.com/api/v1/connection/send-connection-request";try{if(!(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterId:a==null?void 0:a.id,receiverId:e})})).ok)throw new Error("Failed to send connection request.");y(l=>({...l,[e]:!0})),d.success("Connection request sent successfully.")}catch(r){console.error("Error while sending connection request:",r),y(l=>({...l,[e]:!0})),d.info("Already sent connection request.")}finally{x(r=>({...r,[e]:!1}))}},b=async()=>{n(!0);const e="https://app-backend-8r74.onrender.com/api/v1/connection/unsend-connection-request";try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requesterId:a==null?void 0:a.id,receiverId:o})})).ok)throw new Error("Failed to unsend connection request.");p(!1),d.info("Connection request unsent successfully.")}catch(t){console.error("Error while unsending connection request:",t),d.error("Failed to unsend connection request.")}finally{n(!1)}},S=async e=>{const t="https://app-backend-8r74.onrender.com/api/v1/connection/remove-connection";try{const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({connectionId:e})});if(g(),!r.ok)throw new Error("Failed to remove connection request.");p(!1),d.info("Connection request remove successfully.")}catch(r){console.error("Error while remove connection request:",r),d.error("Failed to remove connection request.")}finally{n(!1)}};return s.jsxs(s.Fragment,{children:[s.jsx(F,{title:"Connections"}),s.jsxs(k,{children:[s.jsx(U,{className:"border-0 pb-0",children:s.jsx(E,{children:" Connections"})}),s.jsxs(I,{children:[c&&c.map((e,t)=>{var r,l;return s.jsxs("div",{className:"d-md-flex align-items-center mb-4",children:[s.jsx("div",{className:"avatar me-3 mb-3 mb-md-0",children:e.profilePictureUrl?s.jsx("span",{role:"button",children:s.jsx("img",{className:"avatar-img rounded-circle",src:e.profilePictureUrl,alt:`${e.firstName} ${e.lastName} picture`})}):s.jsxs("span",{className:"avatar-img rounded-circle bg-primary text-white d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"20px"},children:[(r=e.firstName)==null?void 0:r.charAt(0).toUpperCase(),"/",(l=e.lastName)==null?void 0:l.charAt(0).toUpperCase()]})}),s.jsxs("div",{className:"w-100",children:[s.jsxs("div",{className:"d-sm-flex align-items-start",children:[s.jsx("h6",{className:"mb-0",children:s.jsx("a",{href:`/profile/feed/${e.userId}#${e.userId}`,children:`${e.firstName} ${e.lastName}`})}),s.jsx("p",{className:"small ms-sm-2 mb-0",children:e.userRole}),(a==null?void 0:a.id)!==o&&s.jsx("p",{style:{fontSize:"10px"},className:"small text-info ms-sm-2  mb-0",children:e.mutual&&"mutual connection"})]}),s.jsx("ul",{className:"avatar-group mt-1 list-unstyled align-items-sm-center",children:s.jsx("li",{className:z("small",{"ms-3":e.sharedConnectionAvatars}),children:e.meeted})})]}),(e==null?void 0:e.userId)!==(a==null?void 0:a.id)?s.jsx("div",{className:"ms-md-auto d-flex",children:(a==null?void 0:a.id)===o||e.mutual?s.jsxs(s.Fragment,{children:[(a==null?void 0:a.id)===o&&s.jsx(m,{onClick:()=>S(e.connectionId),variant:"danger-soft",size:"sm",className:"mb-0 me-2",children:"Remove"}),s.jsx(m,{variant:"primary-soft",size:"sm",className:"mb-0",children:"Message"})]}):s.jsxs(s.Fragment,{children:[u&&s.jsx(m,{variant:"danger-soft",className:"me-2",type:"button",onClick:b,disabled:h,children:h?s.jsx(N,{size:15,loading:!0}):s.jsx(s.Fragment,{children:s.jsx(T,{size:19,className:"pe-1"})})}),!u&&s.jsx(m,{variant:j[e==null?void 0:e.userId]?"success-soft":"primary-soft",className:"me-2",type:"button",onClick:()=>C(e==null?void 0:e.userId),disabled:f[e==null?void 0:e.userId],children:f[e==null?void 0:e.userId]?s.jsx(N,{size:15,loading:!0}):j[e==null?void 0:e.userId]?s.jsx(s.Fragment,{children:s.jsx(P,{size:19,className:"pe-1"})}):s.jsx(s.Fragment,{children:s.jsx(O,{size:19,className:"pe-1"})})})]})}):s.jsx(A,{to:"/feed/home",className:"mx-4 text-primary",type:"button",children:s.jsx($,{size:19,className:"pe-1"})})]},t)}),s.jsx("div",{className:"d-grid"})]})]})]})};export{R as default};
